{% extends "layout.html" %}
{% block title %}viestit{% endblock %}
{% block content %}

<H1 style="color: rgb(0, 0, 0)">Olet keskustelussa "<i>{{ topicname }}</i>" </H1>
<form action="/{{ topicareaid }}/{{ topicid }}/result" method="GET">
  <input type="text" name="query">
  <input type="submit" value="hae ketjusta">
</form>
<nav>
  <ul>
    <li><a href="/{{ topicareaid }}"> palaa keskusteluihin </a></li>
  </ul>
</nav>

<hr>
{% if session.access_level == "admin" or  topicuserid==session.user_id %}

<br>
<form action="/{{ topicareaid }}/{{ topicid }}/edit" method="POST">
  <textarea name="content" rows="2" cols="40">{{ topicname }}</textarea>
  <input type="submit" value="muokkaa otsikkoa">
</form>

<br>
<form action="/{{ topicareaid }}/{{ topicid }}/delete" method="POST">    
  <input type="submit" value="poista keskustelu">
</form>
<br>
{% endif  %}
<hr>
<br>

<hr> 

<br>

<form action="/{{ topicareaid }}/{{ topicid }}/addnewmessage" method="POST">
  <textarea name="content" rows="5" cols="30"></textarea>  
  <input type="submit" value="Kirjoita uusi viesti">
</form>
<hr>  
{% with messages = get_flashed_messages(with_categories=true) %}
{% for category, message in messages %}
  <div class="{{ category }}">{{ message }}</div>
{% endfor %}
{% endwith %}
<h2>VIESTIT:</h2>

{% for message in messages %}<br>
Käyttäjä <i>{{ message.username }}</i> kirjoitti :"{{ message.content }}"<br>
Luotu: {{ message.created_at.strftime("%Y-%m-%d %H:%M:%S") }}<br>
<br> 
<br> 

{% if message.user_id == session.user_id or session.access_level == "admin" %}
<form action="/{{ topicareaid }}/{{ topicid }}/{{ message.id }}/edit" method="POST">
  <textarea name="content" rows="2" cols="40">{{ message.content }}</textarea>
  <input type="submit" value="muokkaa">
</form>
<br>
<form action="/{{ topicareaid }}/{{ topicid }}/{{ message.id }}" method="POST">   
    <input type="submit" value="poista viesti">
</form>



    {% endif%}
    
<hr>

{% endfor %}


    
    
    





{% endblock %}


